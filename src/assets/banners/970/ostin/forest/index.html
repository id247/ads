<html lang="en-US"><head>
	<meta charset="UTF-8">
	<style type="text/css">
		* {
			margin: 0px;
			padding: 0px;
			box-sizing: border-box;
		}
		body{		
			/*width: 1920px;*/
			overflow: hidden;
		}
		.banner{
			width: 970px;
			height: 200px;
			margin: auto;
			border: 1px solid;
			overflow: hidden;
			position: relative;
		}
		.banner__boy{
			position: absolute;
			top: 230px;
			right: -130px;
			transform-origin: 0 0;
		}

		.banner__href{
			display: block;
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
		}

		.banner__repeat{
			position: absolute;
			top: 20px;
			right: 20px;
			opacity: 0;
		}

		.banner__text{
			position: absolute;
		}

		.banner__text--1{
			top: -120px;
			left: 100px;
		}

		.banner__text--2{
			top: 30px;
			left: 50px;
			opacity: 0;
		}

		.banner__start{
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			opacity: 0;
		}

		.banner__final{
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			opacity: 0;
		}

		.repeat{
			background: transparent url('files/repeat.png');
			text-indent: -9999px;
			width: 98px;
			height: 20px;
			display: block;
			border: 0;
			cursor: pointer;
			outline: none;
		}
		.repeat:after{
			content: '';
			position: absolute;
			top: 2px;
			right: 2px;
			width: 16px;
			height: 16px;
			background: url('files/arrow.png') 50% 0 no-repeat;
		}
		.repeat:hover:after{
			-webkit-transition: all .5s;
			-o-transition: all .5s;
			transition: all .5s;
			transform: rotate(-359deg);
		}

		.final{

		}

		.final__logo{
			position: absolute;
			top: 20px;
			left: 0;
			right: 0;
			display: block;
			margin: auto;
		}

		.final__text{
			position: absolute;
			top: 70px;
			left: 0;
			right: 0;
			display: block;
			margin: auto;
		}

		.fullscreen{
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			min-width: 970px;
			/*width: 1920px;*/
			display: none;
		}

		.fullscreen--visible{
			display: block;
		}
		
		.fullscreen__forest{
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			z-index: 50;
		}

		.forest{
			
		}

		.forest__table{
			position: absolute;
			left: 50%;
			top: 40px;
			margin-left: 148px;
			transform: scale(.51);
			display: none;
		}

		.forest__table--visible{
			display: block;
		}

		.forest__item{
			position: absolute;
			top: 0px;
			left: 50%;
			margin-left: -2800px;
			transform-origin: 50% 0%;
			/*opacity: .3;*/
			display: none;
		}

		.forest__item--visible{
			display: block;
		}

		.forest__item--b1{
			top: 51px;
			margin-left: 147px;
			transform: scale(.51);
		}

		.forest__item--b2{
			top: 37px;
			margin-left: 147px;
			transform: scale(.51);
		}

		.forest__item--b3{
			top: 25px;
			margin-left: 147px;
			transform: scale(.51);
		}

		.forest__item--b4{
			top: 21px;
			margin-left: 147px;
			transform: scale(.51);
		}

		.forest__item--b5{
			top: 22px;
			margin-left: 123px;
			transform: scale(.51);
		}

		.forest__item--b6{
			top: 19px;
			margin-left: 81px;
			transform: scale(.51);
		}

		.forest__item--b7{
			top: 14px;
			margin-left: 50px;
			transform: scale(.51);
		}

		.forest__item--b8{
			top: 5px;
			margin-left: 66px;
			transform: scale(.51);
		}

		.forest__item--b9{
			top: 31px;
			margin-left: 5px;
			transform: scale(.51);
		}

		.forest__item--b10{
			top: 40px;
			margin-left: -45px;
			transform: scale(.51);
		}

		.forest__item--b11{
			top: 40px;
			margin-left: -105px;
			transform: scale(.51);
		}

		.forest__item--b12{
			top: 40px;
			margin-left: -175px;
			transform: scale(.51);
		}

		.forest__item--b13{
			top: 40px;
			margin-left: -305px;
			transform: scale(.51);
		}

		.forest__item--b14{
			top: 40px;
			margin-left: -405px;
			transform: scale(.51);
		}

		.forest__item--b15{
			top: 40px;
			margin-left: -505px;
			transform: scale(.51);
		}

		.forest__item--b16{
			top: 40px;
			margin-left: -655px;
			transform: scale(.51);
		}

		.forest__item--b17{
			top: 40px;
			margin-left: -855px;
			transform: scale(.51);
		}

		.forest__item--b18{
			top: 40px;
			margin-left: -955px;
			transform: scale(.51);
		}

		.forest__item--b19{
			top: 40px;
			margin-left: -1055px;
			transform: scale(.51);
		}

		.forest__item--b19{
			top: 40px;
			margin-left: -1055px;
			transform: scale(.51);
		}

		.forest__item--b23{
			top: 250px;
			margin-left: -1055px;
		}

		.forest__item--b24{
			top: 250px;
			margin-left: -855px;
		}

		.forest__item--b25{
			top: 250px;
			margin-left: -655px;
		}

		.forest__item--b26{
			top: 250px;
			margin-left: -500px;
		}

		.forest__item--b27{
			top: 250px;
			margin-left: -300px;
		}

		.forest__item--b28{
			top: 250px;
			margin-left: -100px;
		}

		.forest__item--b29{
			top: 250px;
			margin-left: 100px;
		}

		.forest__item--b30{
			top: 250px;
			margin-left: 350px;
		}

		.forest__item--b31{
			top: 250px;
			margin-left: 500px;
		}

		.forest__item--b32{
			top: 250px;
			margin-left: 700px;
		}

		.forest__item--b33{
			top: 250px;
			margin-left: 900px;
		}

		._forest-wave{
			background: url('http://localhost:9000/assets/banners/970/ostin/forest/files/mahal.png') 0 0 no-repeat;
			width: 177px;
   			height: 279px;
   			position: absolute;
   			top: 30px;
   			right: -24px;

   			transform: rotate(-75deg);
		}

	</style>
<body marginheight="0">

	<div id="fullscreen" class="fullscreen">
        <div class="fullscreen__forest forest" id="forest">
            <img class="forest__item forest__item--b1" src="files/boy/b1.png">
            <img class="forest__item forest__item--b2" src="files/boy/b2.png">
            <img class="forest__item forest__item--b3" src="files/boy/b3.png">
            <img class="forest__item forest__item--b4" src="files/boy/b4.png">
            <img class="forest__item forest__item--b5" src="files/boy/b5.png">
            <img class="forest__item forest__item--b6" src="files/boy/b6.png">
            <img class="forest__item forest__item--b7" src="files/boy/b7.png">
            <img class="forest__item forest__item--b8" src="files/boy/b8.png">
            <img class="forest__item forest__item--b9" src="files/boy/b9.png">
            <img class="forest__item forest__item--b10" src="files/boy/b10.png">
            <img class="forest__item forest__item--b11" src="files/boy/b11.png">
            <img class="forest__item forest__item--b12" src="files/boy/b12.png">
            <img class="forest__item forest__item--b13" src="files/boy/b13.png">
            <img class="forest__item forest__item--b14" src="files/boy/b14.png">
            <img class="forest__item forest__item--b15" src="files/boy/b15.png">
            <img class="forest__item forest__item--b16" src="files/boy/b12.png">
            <img class="forest__item forest__item--b17" src="files/boy/b13.png">
            <img class="forest__item forest__item--b18" src="files/boy/b14.png">
            <img class="forest__item forest__item--b19" src="files/boy/b11.png">
            <img class="forest__item forest__item--b22" src="files/boy/b14.png">

			<!-- to right -->

            <img class="forest__item forest__item--b23" src="files/boy/b16.png">
            <img class="forest__item forest__item--b24" src="files/boy/b17.png">
            <img class="forest__item forest__item--b25" src="files/boy/b18.png">
            <img class="forest__item forest__item--b26" src="files/boy/b19.png">
            <img class="forest__item forest__item--b27" src="files/boy/b20.png">
            <img class="forest__item forest__item--b28" src="files/boy/b16.png">
            <img class="forest__item forest__item--b29" src="files/boy/b17.png">
            <img class="forest__item forest__item--b30" src="files/boy/b18.png">
            <img class="forest__item forest__item--b31" src="files/boy/b19.png">
            <img class="forest__item forest__item--b32" src="files/boy/b20.png">
            <img class="forest__item forest__item--b33" src="files/boy/b16.png">
            
            <img class="forest__table" src="files/table.png">
        </div>
    </div>

	<div class="banner" id="banner">

		<div class="banner__start">

			<img src="files/boy/b0.png" alt="boy" class="banner__boy" id="banner-boy">
			
			<img src="files/1.gif" alt="1" class="banner__text banner__text--1" id="banner-text-1">
			<img src="files/2.gif" alt="2" class="banner__text banner__text--2" id="banner-text-2">

		</div><!-- /.banner__start -->
	
		<div class="banner__final final">

			<img src="files/logo.png" alt="logo" class="final__logo">

			<img src="files/3.gif" alt="3" class="final__text">
			
		</div><!-- /.banner__final -->

		<a href="http://ya.ru" class="banner__href" target="_blank"></a>

		<button class="banner__repeat repeat" id="repeat">Повторить</button>

	</div><!-- /.banner -->


	<script src="files/EasePack.min.js"></script>
	<script src="files/CSSPlugin.min.js"></script>
	<script src="files/TweenLite.min.js"></script>
	<script src="files/TweenLite.min.js"></script>
	<script src="files/TimelineLite.min.js"></script>
	<script>

		;(function(){

			var bannerBoy = document.querySelector('#banner-boy');
			var boyRun = document.querySelectorAll('.forest__item');
			var table = document.querySelector('.forest__table');
			var fullscreen = document.querySelector('.fullscreen');
			var repeat = document.querySelector('.repeat');
			var bannerText1 = document.querySelector('#banner-text-1');
			var bannerText2 = document.querySelector('#banner-text-2');
			var repeat = document.querySelector('#repeat');
			var bannerStart = document.querySelector('.banner__start');
			var bannerFinal = document.querySelector('.banner__final');


			var timeLine = new TimelineLite({paused:true});

			var parentFrameNode;
			var parentDoc;
			var paddingDiv;
			var wave;

			var waveAnimationEnabled = false;

			var height = '900px';



			function run(callback){
			
				var run = function(i){
					if (i <= boyRun.length){
						boyRun[i-1] && boyRun[i-1].classList.remove('forest__item--visible');
						boyRun[i] && boyRun[i].classList.add('forest__item--visible');

						if (i === 5){
							table.classList.add('forest__table--visible');
						}

						if (i === 20){
							fullSize();
						}

						if (i === boyRun.length){
							callback();
							defaultSize();
						}
						
						setTimeout(function(){
							run(++i);
						}, 100);
					}
				}				
				run(0);
			}

			function waveAnimation(wave, callback){
				
				function animate(i){
					if (!waveAnimationEnabled){
						return;
					}
					
					if (i === 8){
						i = 0;
					}
					var position = -177 * i;
					setStyle(wave, {
						backgroundPosition: position + 'px 0',
					});	
					setTimeout(function(){
						animate(++i);	
					}, 200);
					
				}
				animate(0);
			};

			function createTimeline(){

				timeLine.set(bannerStart, {
					opacity: 1,
				})
				.fromTo(bannerText1, 1.0,{
					top: '-130px',
					scale: 1,
				},{	
					top: '45px',
					//ease: Power2.easeOut,
				})
				.to(bannerBoy, 1.0, {
					top: '0px',
					//ease: Power2.easeOut,
				}, 0)
				.to(bannerBoy, 1.0, {
					scale: .3,
					top: '50px',
					//ease: Power2.easeOut,
				}, '+=.5')
				.to(bannerText1, 1.0, {
					opacity: 0,
					scale: 0,
					//ease: Bounce.easeOut,
				})
				.fromTo(bannerText2, 1.2, {
					opacity: 0,
					scale: 0,
				},{
					opacity: 1,
					scale: 1,
					//ease: Power2.easeOut,
				}, '-=.4')
				.set(bannerBoy, {
					display: 'none',	
				})
				.set(fullscreen, {
					display: 'block',	
				})
				.append(TweenLite.delayedCall(0, function(){
					timeLine.pause();
					run(function(){
						timeLine.resume();
					});
				}))
				.to(repeat, .3, {
					opacity: 1,
					visibility: 'visible',
					//ease: Bounce.easeOut,
				})
				.set(bannerBoy, {
					display: 'none'
				})
				.to(fullscreen, .3, {
					opacity: 0,
				})
				.to(bannerText2, .6, {
					opacity: 0,
					scale: 0,
					ease: Back.easeInOut,
				}, 'final')
				.to(bannerStart, .5, {
					opacity: 0,
					//ease: Bounce.easeOut,
				}, 'final')
				.fromTo(bannerFinal, .6, {
					opacity: 0,
					//ease: Bounce.easeOut,
				},{
					opacity: 1,
					onComplete: function(){
						waveAnimationEnabled = true;
						waveAnimation(wave);
					}
					//ease: Bounce.easeOut,
				}, '-=.3')
				.fromTo(wave, .5,{
					right: '-250px'
				},{
					right: '-24px'
				})
				.to(wave, .5,{
					right: '-250px',
					onComplete: function(){
						waveAnimationEnabled = false;
					}
				}, '+=1.5');
			}

			function fullSize(){
				setStyle(parentFrameNode, {
					height: height
				});
				setStyle(frameElement, {
					height: height
				});		
			}

			function defaultSize(){
				setStyle(parentFrameNode, {
					height: ''
				});
				setStyle(frameElement, {
					height: ''
				});			
			}

			function setStyle(el, styles){
				if (!el || !el.style){
					return;
				}
				for (var key in styles){
					el.style[key] = styles[key];
				}
			}

			function createWave(){
				var parentDoc = window.parent ? window.parent.document : document;
				wave = parentDoc.createElement('div');

				setStyle(wave, {
					background: 'url(http://localhost:9000/assets/banners/970/ostin/forest/files/mahal.png) 0 0 no-repeat',
					width: '177px',
		   			height: '279px',
		   			position: 'fixed',
		   			top: '30px',
		   			right: '-24px',
					'-webkit-transform': 'rotate(-75deg)',
					'-ms-transform': 'rotate(-75deg)',
					'-o-transform': 'rotate(-75deg)',
					transform: 'rotate(-75deg)',
				});

				

				parentDoc.body.appendChild(wave);
			}

			function iframePosition(){

				//of in iframe
				if (!window.parent || !frameElement){
					return;
				}

				parentDoc = window.parent.document;
				parentFrameNode = frameElement.parentNode;

				paddingDiv = parentDoc.createElement('div');
				paddingDiv.style.height = '200px';

				setStyle(parentFrameNode, {
					position: 'absolute',
					top: 0,
					left: 0,
					right: 0,
					width: '100%',
					zIndex: 10000000000
				});

				setStyle(frameElement, {
					width: '100%'
				});

				parentFrameNode.parentNode.insertBefore(paddingDiv, parentFrameNode.parentNode.firstChild);
			}

			function init(){
				console.log('start');
				iframePosition();

				createWave();

				createTimeline();


				//timeLine.seek('final');
				timeLine.play();

				repeat.addEventListener('click', function(e){
					e.preventDefault();
					timeLine.restart();
				});
			}

			window.onload = function(){
				init();
			}

		})();

	</script>

</body>
</html>
